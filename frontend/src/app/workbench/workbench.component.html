<!--
 Copyright 2025 Google LLC

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<div class="workbench-container">
  <!-- Beta Label -->
  <div matTooltip="This is currenty under development, it does not save content so use at your own risk, make sure to download your work before you leave this page!" class="beta-label">
    BETA
  </div>
  <!-- Main App Container (Dark Theme) -->
  <div
    class="main-app-container"
    (mousemove)="onTrimMove($event); onDragMove($event); onScrubMove($event)"
    (mouseup)="onTrimEnd(); onDragEnd(); onScrubEnd()"
  >
    <!-- Top Workspace (2 Columns) -->
    <div class="flex flex-row justify-center items-center gap-6">
      <!-- COL 1: Assets Panel -->
      <div
        *ngIf="
          activeToolButton() === 'gallery' ||
          activeToolButton() === 'audio' ||
          activeToolButton() === 'stories'
        "
        class="side-panel"
      >
        <div class="flex items-center justify-between mb-4">
          <h5 class="text-lg font-semibold">Assets</h5>
        </div>

        <!-- Grid of assets -->
        <div
          class="flex-1 overflow-y-auto grid grid-cols-2 gap-3 content-start custom-scrollbar"
        >
          <!-- "Add New" Card (Cloud Media Selector) -->
          <div
            (click)="openMediaSelector()"
            class="aspect-square border-2 border-dashed border-gray-700 rounded-xl flex flex-col items-center justify-center text-gray-500 gap-2 cursor-pointer hover:border-blue-500 hover:text-blue-400 transition-colors relative group bg-[#151517]"
          >
            <div
              class="w-12 h-12 rounded-full bg-gray-800 group-hover:bg-blue-500/20 flex items-center justify-center transition-colors"
            >
              <mat-icon class="!w-6 !h-6">filter_drama</mat-icon>
            </div>
            <span class="text-[10px] font-medium">Add from Cloud</span>
          </div>

          <!-- Asset Cards (filtered by activeTab) -->
          <div
            *ngFor="let asset of filteredAssets()"
            (click)="addToTimeline(asset)"
            class="group relative aspect-square bg-black rounded-xl overflow-hidden border border-white/5 cursor-pointer hover:ring-2 hover:ring-blue-500/50 transition-all"
          >
            <img
              *ngIf="asset.thumbnail"
              [src]="asset.thumbnail"
              class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity"
              (error)="onThumbnailError(asset)"
            />
            <div
              *ngIf="!asset.thumbnail && asset.type === 'video'"
              class="w-full h-full flex items-center justify-center bg-gray-900"
            >
              <svg
                class="text-blue-400 w-8 h-8"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
              </svg>
            </div>
            <div
              *ngIf="!asset.thumbnail && asset.type === 'audio'"
              class="w-full h-full flex items-center justify-center bg-gray-900"
            >
              <svg
                class="text-purple-400 w-8 h-8"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M9 18V5l12-2v13" />
                <circle cx="6" cy="18" r="3" />
                <circle cx="18" cy="16" r="3" />
              </svg>
            </div>

            <!-- Overlay Info -->
            <div
              class="absolute bottom-0 inset-x-0 p-2 bg-gradient-to-t from-black/90 to-transparent"
            >
              <p class="text-[10px] font-medium truncate text-white">
                {{ asset.name }}
              </p>
              <p class="text-[9px] text-gray-400">
                {{ formatTime(asset.duration) }}
              </p>
            </div>

            <!-- Delete Button (Hover) -->
            <button
              (click)="deleteAsset(asset, $event)"
              class="absolute top-2 right-2 bg-red-500/80 hover:bg-red-600 rounded-full p-1.5 opacity-0 group-hover:opacity-100 transition-all hover:scale-110 shadow-lg"
              title="Delete Asset"
            >
              <mat-icon
                class="!w-4 !h-4 text-white text-[16px] leading-none flex items-center justify-center"
                >delete</mat-icon
              >
            </button>
          </div>
        </div>

        <!-- Bottom Tabs (Video / Audio filter) -->
        <div class="mt-4 flex gap-2 justify-center">
          <button
            mat-button
            (click)="activeTab.set('video')"
            class="btn-glass-primary btn-medium"
            [class.btn-glass-circle]="activeTab() !== 'video'"
          >
            <mat-icon svgIcon="video-clap-icon" class="!w-5 !h-5"></mat-icon>
            <span
              *ngIf="activeTab() === 'video'"
              class="font-bold whitespace-nowrap"
              >Videos</span
            >
          </button>
          <button
            mat-button
            (click)="activeTab.set('audio')"
            class="btn-glass-primary btn-medium"
            [class.btn-glass-circle]="activeTab() !== 'audio'"
          >
            <mat-icon svgIcon="sound-sensing-icon" class="!w-5 !h-5"></mat-icon>
            <span
              *ngIf="activeTab() === 'audio'"
              class="font-bold whitespace-nowrap"
              >Audio</span
            >
          </button>
          <div matTooltip="Drive coming soon!" class="inline-block">
            <button
              mat-button
              disabled
              class="btn-glass-primary btn-medium btn-glass-circle"
            >
              <mat-icon
                svgIcon="drive-icon"
                class="!w-5 !h-5 grayscale opacity-50"
              ></mat-icon>
            </button>
          </div>
          <!-- Functional Upload Button -->
          <button
            mat-button
            (click)="openMediaSelector()"
            class="btn-glass-primary btn-medium btn-glass-circle"
            matTooltip="Upload Media"
          >
            <mat-icon svgIcon="upload-icon" class="!w-5 !h-5"></mat-icon>
          </button>
        </div>
      </div>

      <!-- COL 2: Properties Panel -->
      <div *ngIf="activeToolButton() === 'edit'" class="side-panel">
        <!-- Aspect Ratio -->
        <div class="mb-8">
          <h3 class="text-white-900 text-sm font-medium mb-3">Aspect Ratio</h3>
          <div class="grid grid-cols-4 gap-2">
            <button
              class="w-[5rem] h-[2.5rem] flex flex-row items-center justify-center gap-1.5 py-2 px-2 rounded-xl text-s font-medium glass-bg-effect backdrop-blur-[10px]"
            >
              <mat-icon svgIcon="desktop-mac-icon" class="!w-5 !h-5"></mat-icon>
              <span class="text-sm font-medium">16:9</span>
            </button>
            <button
              class="w-[5rem] h-[2.5rem] flex flex-row items-center justify-center gap-1.5 py-2 px-2 rounded-xl text-s font-medium glass-bg-effect backdrop-blur-[10px]"
            >
              <mat-icon svgIcon="desktop-icon" class="!w-5 !h-5"></mat-icon>
              <span class="text-sm font-medium">9:16</span>
            </button>
            <button
              class="w-[5rem] h-[2.5rem] flex flex-row items-center justify-center gap-1.5 py-2 px-2 rounded-xl text-s font-medium glass-bg-effect backdrop-blur-[10px]"
            >
              <mat-icon svgIcon="square-icon" class="!w-5 !h-5"></mat-icon>
              <span class="text-sm font-medium">1:1</span>
            </button>
            <button
              class="w-[5rem] h-[2.5rem] flex flex-row items-center justify-center gap-1.5 py-2 px-2 rounded-xl text-s font-medium glass-bg-effect backdrop-blur-[10px]"
            >
              <mat-icon svgIcon="desktop-icon" class="!w-5 !h-5"></mat-icon>
              <span class="text-sm font-medium">4:3</span>
            </button>
          </div>
        </div>

        <!-- Lighting Controls -->
        <div class="flex-1 w-[90%] mt-4">
          <div class="flex items-center gap-2 text-gray-200 mb-2">
            <mat-icon svgIcon="lightbulb-icon" class="!w-10 !h-10"></mat-icon>
            <h3 class="!m-0">Lighting</h3>
          </div>
          <div class="flex flex-col gap-3">
            <!-- Exposure Slider -->
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-base font-medium">Exposure</span>
                <span>{{ exposureVal }}%</span>
              </div>
              <mat-slider
                min="10"
                max="100"
                step="5"
                class="glass-slider py-2 !w-full"
              >
                <input matSliderThumb value="50" />
              </mat-slider>
            </div>

            <!-- Contrast Slider -->
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-base font-medium">Contrast</span>
                <span>{{ contrastVal }}%</span>
              </div>
              <mat-slider
                min="10"
                max="100"
                step="5"
                class="glass-slider py-2 !w-full"
              >
                <input matSliderThumb value="50" />
              </mat-slider>
            </div>

            <!-- Saturation Slider -->
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-base font-medium">Highlights</span>
                <span>{{ saturateVal }}%</span>
              </div>
              <mat-slider
                min="10"
                max="100"
                step="5"
                class="glass-slider py-2 !w-full"
              >
                <input matSliderThumb value="50" />
              </mat-slider>
            </div>

            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-base font-medium">Shadows</span>
                <span>{{ saturateVal }}%</span>
              </div>
              <mat-slider
                min="10"
                max="100"
                step="5"
                class="glass-slider py-2 !w-full"
              >
                <input matSliderThumb value="50" />
              </mat-slider>
            </div>
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-base font-medium">whites</span>
                <span>{{ saturateVal }}%</span>
              </div>
              <mat-slider
                min="10"
                max="100"
                step="5"
                class="glass-slider py-2 !w-full"
              >
                <input matSliderThumb value="50" />
              </mat-slider>
            </div>
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-base font-medium">Blacks</span>
                <span>{{ saturateVal }}%</span>
              </div>
              <mat-slider
                min="10"
                max="100"
                step="5"
                class="glass-slider py-2 !w-full"
              >
                <input matSliderThumb value="50" />
              </mat-slider>
            </div>
          </div>
        </div>
        <!-- color Controls-->
        <div class="flex-1 w-[90%] mt-4">
          <div class="flex items-center gap-2 text-gray-200 mb-2">
            <mat-icon svgIcon="lightbulb-icon" class="!w-10 !h-10"></mat-icon>
            <h3 class="!m-0">Colors</h3>
          </div>
          <div class="flex flex-col gap-3">
            <!-- Exposure Slider -->
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-base font-medium">Temp</span>
                <span>{{ exposureVal }}%</span>
              </div>
              <mat-slider
                min="10"
                max="100"
                step="5"
                class="glass-slider py-2 !w-full"
              >
                <input matSliderThumb value="50" />
              </mat-slider>
            </div>

            <!-- Contrast Slider -->
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-base font-medium">Tint</span>
                <span>{{ contrastVal }}%</span>
              </div>
              <mat-slider
                min="10"
                max="100"
                step="5"
                class="glass-slider py-2 !w-full"
              >
                <input matSliderThumb value="50" />
              </mat-slider>
            </div>

            <!-- Saturation Slider -->
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-base font-medium">Vibrance</span>
                <span>{{ saturateVal }}%</span>
              </div>
              <mat-slider
                min="10"
                max="100"
                step="5"
                class="glass-slider py-2 !w-full"
              >
                <input matSliderThumb value="50" />
              </mat-slider>
            </div>
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-base font-medium">Saturation</span>
                <span>{{ saturateVal }}%</span>
              </div>
              <mat-slider
                min="10"
                max="100"
                step="5"
                class="glass-slider py-2 !w-full"
              >
                <input matSliderThumb value="50" />
              </mat-slider>
            </div>
          </div>
        </div>
        <!--effect controls-->
        <div class="flex-1 w-[90%] mt-4">
          <div class="flex items-center gap-2 text-gray-200 mb-2">
            <mat-icon svgIcon="lightbulb-icon" class="!w-10 !h-10"></mat-icon>
            <h3 class="!m-0">Effects</h3>
          </div>
          <div class="flex flex-col gap-3">
            <!-- Exposure Slider -->
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-base font-medium">Texture</span>
                <span>{{ exposureVal }}%</span>
              </div>
              <mat-slider
                min="10"
                max="100"
                step="5"
                class="glass-slider py-2 !w-full"
              >
                <input matSliderThumb value="50" />
              </mat-slider>
            </div>

            <!-- Contrast Slider -->
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-base font-medium">Clarity</span>
                <span>{{ contrastVal }}%</span>
              </div>
              <mat-slider
                min="10"
                max="100"
                step="5"
                class="glass-slider py-2 !w-full"
              >
                <input matSliderThumb value="50" />
              </mat-slider>
            </div>

            <!-- Saturation Slider -->
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-base font-medium">Dehaze</span>
                <span>{{ saturateVal }}%</span>
              </div>
              <mat-slider
                min="10"
                max="100"
                step="5"
                class="glass-slider py-2 !w-full"
              >
                <input matSliderThumb value="50" />
              </mat-slider>
            </div>

            <!-- Exposure Slider -->
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-base font-medium">Vignette</span>
                <span>{{ exposureVal }}%</span>
              </div>
              <mat-slider
                min="10"
                max="100"
                step="5"
                class="glass-slider py-2 !w-full"
              >
                <input matSliderThumb value="50" />
              </mat-slider>
            </div>

            <!-- Contrast Slider -->
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-base font-medium">Grain size</span>
                <span>{{ contrastVal }}%</span>
              </div>
              <mat-slider
                min="10"
                max="100"
                step="5"
                class="glass-slider py-2 !w-full"
              >
                <input matSliderThumb value="50" />
              </mat-slider>
            </div>

            <!-- Saturation Slider -->
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-base font-medium">Grain Roughness</span>
                <span>{{ saturateVal }}%</span>
              </div>
              <mat-slider
                min="10"
                max="100"
                step="5"
                class="glass-slider py-2 !w-full"
              >
                <input matSliderThumb value="50" />
              </mat-slider>
            </div>
          </div>
        </div>
        <!--Detail Controls-->
        <div class="flex-1 w-[90%] mt-4">
          <div class="flex items-center gap-2 text-gray-200 mb-2">
            <mat-icon svgIcon="lightbulb-icon" class="!w-10 !h-10"></mat-icon>
            <h3 class="!m-0">Detail</h3>
          </div>
          <div class="flex flex-col gap-3">
            <!-- Exposure Slider -->
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-base font-medium">Sharpning</span>
                <span>{{ exposureVal }}%</span>
              </div>
              <mat-slider
                min="10"
                max="100"
                step="5"
                class="glass-slider py-2 !w-full"
              >
                <input matSliderThumb value="50" />
              </mat-slider>
            </div>

            <!-- Contrast Slider -->
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-base font-medium">Radius</span>
                <span>{{ contrastVal }}%</span>
              </div>
              <mat-slider
                min="10"
                max="100"
                step="5"
                class="glass-slider py-2 !w-full"
              >
                <input matSliderThumb value="50" />
              </mat-slider>
            </div>

            <!-- Saturation Slider -->
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-base font-medium">Detail</span>
                <span>{{ saturateVal }}%</span>
              </div>
              <mat-slider
                min="10"
                max="100"
                step="5"
                class="glass-slider py-2 !w-full"
              >
                <input matSliderThumb value="50" />
              </mat-slider>
            </div>
          </div>
        </div>
      </div>

      <!-- COL 3: Preview Area -->
      <div
        class="glass-bg-effect flex-1 max-w-[80rem] min-h-[500px] flex flex-col items-center justify-center rounded-xl overflow-hidden rounded-[48px]"
      >
        <!-- Video Player (Flexible Size) -->
        <div
          class="relative w-full flex-1 flex items-center justify-center group bg-black/20 rounded-lg overflow-hidden"
        >
          <!-- Placeholder when no video (Empty State) -->
          <div
            [class.hidden]="activeVideoClip()"
            class="absolute inset-0 h-full flex flex-col items-center justify-center text-white/80 pointer-events-none select-none z-10 w-full h-full"
          >
            <!-- Text for Tablet and beyond -->
            <div
              class="hidden md:flex justify-center items-center w-full h-full absolute"
            >
              <mat-icon
                svgIcon="white-gemini-spark-icon"
                class="!w-12 !h-12 mr-2 md:mr-[1rem] !z-[50]"
              ></mat-icon>
              <h1
                class="text-center justify-center text-white text-2xl font-extrabold !m-0 !z-[100]"
              >
                Welcome to Creative Studio
              </h1>
            </div>
            <div
              class="gradient-bg hidden md:block !relative !w-full !h-full !z-[10]"
            >
              <svg xmlns="http://www.w3.org/2000/svg">
                <defs>
                  <filter id="goo">
                    <feGaussianBlur
                      in="SourceGraphic"
                      stdDeviation="10"
                      result="blur"
                    />
                    <feColorMatrix
                      in="blur"
                      mode="matrix"
                      values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -8"
                      result="goo"
                    />
                    <feBlend in="SourceGraphic" in2="goo" />
                  </filter>
                </defs>
              </svg>
              <div class="gradients-container absolute top-0 left-0">
                <div class="g1"></div>
                <div class="g2"></div>
                <div class="g3"></div>
                <div class="g4"></div>
                <div class="g5"></div>
                <div #interactiveBubble class="interactive"></div>
              </div>
            </div>

            <!-- Text for mobile -->
            <div
              class="flex justify-center items-center w-full h-full md:hidden"
            >
              <!-- As this svg uses a gradient, it needs to have a different fill id, therefore we have one for mobile and other for larger devices -->
              <mat-icon
                svgIcon="mobile-white-gemini-spark-icon"
                class="!w-6 !h-6 mr-2 md:mr-[1rem]"
              ></mat-icon>
              <div
                class="text-center justify-center text-white title-font font-bold"
              >
                Welcome to Creative Studio
              </div>
            </div>
          </div>

          <!-- The Video Element -->
          <video
            #mainVideo
            class="max-w-full max-h-full object-contain shadow-2xl rounded-lg"
            [class.hidden]="!activeVideoClip()"
            [style.filter]="videoFilter()"
            [src]="activeVideoSrc()"
            [muted]="true"
            (loadedmetadata)="onMetadataLoaded()"
            (ended)="onVideoEnded()"
          ></video>

          <!-- Hidden Audio (Multi-track) -->
          <ng-container *ngFor="let src of activeAudioSrcs()">
            <audio #bgAudio [src]="src"></audio>
          </ng-container>

          <!-- Playback Controls Overlay (Hover) -->
          <div
            [class.hidden]="!activeVideoClip()"
            class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-20"
          >
            <div
              *ngIf="!isPlaying()"
              class="w-16 h-16 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center cursor-pointer pointer-events-auto shadow-lg ring-1 ring-white/20"
              (click)="togglePlay()"
            >
              <svg
                class="fill-white ml-1"
                width="32"
                height="32"
                viewBox="0 0 24 24"
              >
                <path d="M8 5v14l11-7z" />
              </svg>
            </div>
          </div>
        </div>

        <!-- Time Display Pill -->
        <!-- <div
                                                                                    class="absolute bottom-6 px-4 py-1.5 text-white/90 z-20 bg-gradient-to-b from-zinc-500/50 to-neutral-700/20 rounded-3xl shadow-[2px_2px_12px_0px_rgba(0,0,0,0.10)] outline outline-1 outline-offset-[-1px] outline-stone-300/80 backdrop-blur-[10px]">
                                                                                    {{ formatTime(currentTime()) }} <span class="text-gray-600 mx-1">/</span> {{
                                                                                    formatTime(totalDuration()) }}
                                                                                </div> -->
      </div>
    </div>

    <!-- Bottom Timeline (Floating) -->
    <div class="p-6 flex flex-col overflow-hidden relative z-10">
      <div
        class="flex flex-col overflow-hidden relative max-w-[108rem] w-[100%] mx-auto"
      >
        <!-- Timeline Header / Toolbar -->
        <div class="flex flex-row align-items-start">
          <div class="h-16 w-[20rem] flex items-center justify-start gap-4">
            <div class="flex gap-3 p-2">
              <button
                mat-button
                (click)="toggleToolButton('gallery')"
                class="btn-glass-primary btn-medium"
                [class.btn-glass-circle]="activeToolButton() !== 'gallery'"
              >
                <mat-icon
                  svgIcon="photo-merge-auto-icon"
                  class="!w-5 !h-5"
                ></mat-icon>
                <span
                  *ngIf="activeToolButton() === 'gallery'"
                  class="font-bold whitespace-nowrap"
                  >Gallery</span
                >
              </button>
              
              <div matTooltip="Audio coming soon!" class="inline-block">
                <button
                  mat-button
                  disabled
                  class="btn-glass-primary btn-medium btn-glass-circle"
                >
                  <mat-icon
                    svgIcon="audio-magic-eraser-icon"
                    class="!w-5 !h-5"
                  ></mat-icon>
                </button>
              </div>

              <div matTooltip="Stories coming soon!" class="inline-block">
                <button
                  mat-button
                  disabled
                  class="btn-glass-primary btn-medium btn-glass-circle"
                >
                  <mat-icon
                    svgIcon="web-stories-icon"
                    class="!w-5 !h-5"
                  ></mat-icon>
                </button>
              </div>

              <div matTooltip="Edit coming soon!" class="inline-block">
                <button
                  mat-button
                  disabled
                  class="btn-glass-primary btn-medium btn-glass-circle"
                >
                  <mat-icon svgIcon="edit-icon" class="!w-5 !h-5"></mat-icon>
                </button>
              </div>

              <div matTooltip="Agent coming soon!" class="inline-block">
                <button
                  mat-button
                  disabled
                  class="btn-glass-primary btn-medium btn-glass-circle"
                >
                  <mat-icon
                    svgIcon="gemini-spark-icon"
                    class="!w-5 !h-5"
                  ></mat-icon>
                </button>
              </div>
            </div>
          </div>

          <div
            class="flex flex-row w-[calc(100%-20rem)] items-center gap-1 mt-[0.5rem]"
          >
            <!-- Time Ruler -->
            <div
              class="glass-bg-effect h-[36px] ml-12 p-2 overflow-x-hidden w-full sticky top-0 z-10 rounded-3xl backdrop-blur-[7.5px]"
            >
              <div class="relative h-full" [style.width.px]="timelineWidth()">
                <!-- Major ticks with labels (every second) -->
                <ng-container *ngFor="let tick of timeRulerTicks()">
                  <!-- Major tick line (every 10 seconds) or minor tick (every 2 seconds) -->
                  <div
                    class="absolute top-0 flex items-center"
                    [style.left.px]="tick * pixelsPerSecond"
                  >
                    <div
                      *ngIf="isMajorTick(tick)"
                      class="w-1 h-4 bg-white rounded-b-2xl"
                    ></div>
                    <div
                      *ngIf="!isMajorTick(tick)"
                      class="w-0.5 h-2 bg-white/60 rounded-b-2xl"
                    ></div>
                    <span
                      *ngIf="isMajorTick(tick)"
                      class="text-[10px] font-semibold text-white/90 ml-1"
                      >{{ formatTimeRuler(tick) }}</span
                    >
                  </div>
                </ng-container>
              </div>
            </div>

            <div class="flex flex-row gap-2 items-center ml-auto">
              <!-- Zoom Slider -->
              <div
                class="zoom-slider flex flex-row items-center rounded-3xl px-4 h-[36px]"
              >
                <mat-icon>zoom_out</mat-icon>
                <mat-slider
                  min="10"
                  max="100"
                  step="5"
                  class="glass-slider py-2"
                >
                  <input
                    matSliderThumb
                    value="10"
                    [(ngModel)]="pixelsPerSecond"
                  />
                </mat-slider>
                <mat-icon>zoom_in</mat-icon>
                <!-- <input type="range" [(ngModel)]="pixelsPerSecond" min="5" max="100" step="5"
                                                                                                                                                                    class="w-20 h-1 bg-gray-700 rounded-full appearance-none cursor-pointer accent-gray-400"> -->
              </div>
              <!-- Split Button -->
              <button
                mat-button
                (click)="splitSelectedClip()"
                [disabled]="!canSplit()"
                class="btn-glass-circle btn-medium"
                title="Split Clip (Razor)"
              >
                <mat-icon class="!w-5 !h-5">content_cut</mat-icon>
              </button>
              <button
                mat-button
                (click)="deleteSelectedClip()"
                [disabled]="!selectedClipId()"
                class="btn-glass-circle btn-medium"
              >
                <mat-icon class="!w-5 !h-5">delete</mat-icon>
              </button>
            </div>
          </div>
        </div>

        <!-- Tracks Area -->
        <div
          class="glass-bg-effect min-h-[12rem] max-w-[108rem] w-[100%] flex-1 flex flex-col items-end p-2 rounded-2xl backdrop-blur-[50px] relative"
          #timelineContainer
        >
          <button
            mat-raised-button
            class="btn-cta btn-small !absolute top-2 right-2 z-30"
            (click)="downloadVideo()"
            [disabled]="timelineClips().length === 0 || isDownloading()"
          >
            <mat-icon *ngIf="!isDownloading()">download</mat-icon>
            <mat-icon *ngIf="isDownloading()" class="animate-spin">sync</mat-icon>
            <span>{{ isDownloading() ? 'Rendering...' : 'Download' }}</span>
          </button>
          <div class="w-full flex-1 flex">
            <!-- Left Track Controls -->
            <div
              class="w-[16rem] flex flex-col align-items-center justify-evenly z-20 relative"
            >
              <!-- Video Control -->
              <div class="flex flex-row items-center justify-between">
                <div
                  class="h-14 flex items-center px-3 gap-6 border-b border-white/5"
                >
                  <mat-icon
                    svgIcon="movie-shallow-icon"
                    class="!w-6 !h-6"
                  ></mat-icon>
                  <div class="glass-toolbar">
                    <div matTooltip="coming soon!" class="inline-block">
                        <button mat-button disabled class="glass-toolbar-btn">
                        <mat-icon svgIcon="eye-icon"></mat-icon>
                        </button>
                    </div>
                    <div matTooltip="coming soon!" class="inline-block">
                        <button mat-button disabled class="glass-toolbar-btn">
                        <mat-icon svgIcon="lock-icon"></mat-icon>
                        </button>
                    </div>
                  </div>
                </div>
                <button
                  mat-button
                  (click)="togglePlay()"
                  class="btn-glass-primary btn-large btn-glass-circle mr-8"
                >
                  <mat-icon
                    *ngIf="!isPlaying()"
                    svgIcon="play-arrow-icon"
                  ></mat-icon>
                  <mat-icon *ngIf="isPlaying()">pause</mat-icon>
                </button>
              </div>
              <!-- Audio Control (Dynamic) -->
              <div
                *ngFor="let track of audioTracks(); let i = index"
                class="h-14 flex items-center px-3 gap-6 mt-2"
              >
                <mat-icon
                  svgIcon="sound-sensing-icon"
                  class="!w-6 !h-6"
                ></mat-icon>
                <div class="glass-toolbar">
                  <div matTooltip="coming soon!" class="inline-block">
                    <button mat-button disabled class="glass-toolbar-btn">
                      <mat-icon svgIcon="lock-icon"></mat-icon>
                    </button>
                  </div>
                  <div matTooltip="coming soon!" class="inline-block">
                    <button mat-button disabled class="glass-toolbar-btn">
                      <mat-icon svgIcon="volume-off-icon"></mat-icon>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Main Scrollable Timeline -->
            <div
              #timelineContainer
              class="flex-1 overflow-x-auto overflow-y-hidden relative"
              (mousedown)="onTimelineMouseDown($event)"
            >
              <div
                class="relative max-w-[calc(100%-20rem)] h-full"
                [style.width.px]="timelineWidth()"
              >
                <!-- Playhead -->
                <div
                  class="absolute top-0 bottom-0 w-px bg-white pointer-events-none !z-[100]"
                  [style.left.px]="currentTime() * pixelsPerSecond"
                >
                  <!-- Transparent Hit Box for Dragging -->
                  <div
                    class="absolute top-0 bottom-0 w-6 -left-3 cursor-grab active:cursor-grabbing pointer-events-auto z-[101] hover:bg-white/5 transition-colors"
                    (mousedown)="onScrubStart($event)"
                  ></div>

                  <!-- Handle Circle -->
                  <div
                    class="w-3 h-3 -ml-1.5 bg-white rounded-full -mt-1.5 shadow-[0_0_10px_rgba(255,255,255,0.5)] pointer-events-none relative z-[102]"
                  ></div>
                  <!-- <div
                                                                                                                                                                                    class="absolute bottom-2 left-2 bg-[#2a2a2c] text-[9px] px-1.5 py-0.5 rounded text-white border border-white/10 whitespace-nowrap z-50">
                                                                                                                                                                                    {{formatTime(currentTime())}}
                                                                                                                                                                                </div> -->
                </div>

                <!-- VIDEO TRACK (draggable clips) -->
                <div class="h-14 mt-2 relative w-full">
                  <div
                    *ngFor="let clip of videoClips()"
                    (mousedown)="startDrag($event, clip)"
                    (click)="selectClip(clip.id, $event)"
                    class="absolute top-1 bottom-1 rounded-xl cursor-pointer overflow-hidden border flex items-center group"
                    [ngClass]="{
                      'border-blue-500 ring-2 ring-blue-500/50 shadow-xl shadow-blue-500/40 z-30':
                        selectedClipId() === clip.id,
                      'border-white/10 bg-[#2a2a2c] hover:border-white/30':
                        selectedClipId() !== clip.id,
                    }"
                    [style.left.px]="clip.startTime * pixelsPerSecond"
                    [style.width.px]="clip.duration * pixelsPerSecond"
                  >
                    <!-- Thumbnail Strip (when thumbnail available) -->
                    <div
                      *ngIf="getAssetThumbnail(clip.assetId)"
                      class="absolute inset-0 flex opacity-50 group-hover:opacity-70 transition-opacity pointer-events-none grayscale group-hover:grayscale-0 overflow-hidden"
                    >
                      <ng-container *ngFor="let i of [1, 2, 3, 4, 5]">
                        <img
                          [src]="getAssetThumbnail(clip.assetId)"
                          class="h-full object-cover w-20 flex-shrink-0"
                        />
                      </ng-container>
                    </div>

                    <!-- Fallback gradient when no thumbnail -->
                    <div
                      *ngIf="!getAssetThumbnail(clip.assetId)"
                      class="absolute inset-0 bg-gradient-to-r from-blue-900/50 to-blue-700/30 flex items-center justify-center"
                    >
                      <svg
                        class="text-blue-400 w-6 h-6 opacity-50"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                      </svg>
                    </div>

                    <!-- Trim Handles -->
                    <div
                      class="absolute left-0 top-0 bottom-0 w-1.5 bg-white/40 cursor-ew-resize"
                    ></div>
                    <div
                      class="absolute right-0 top-0 bottom-0 w-1.5 bg-white/40 cursor-ew-resize"
                    ></div>
                  </div>
                </div>

                <!-- AUDIO TRACKS (draggable clips) -->
                <div
                  *ngFor="let track of audioTracks(); let i = index"
                  class="h-14 mt-2 relative w-full"
                >
                  <div
                    *ngFor="let clip of track"
                    (mousedown)="startDrag($event, clip)"
                    (click)="selectClip(clip.id, $event)"
                    class="absolute top-2 bottom-2 rounded-lg cursor-pointer overflow-hidden border flex items-center justify-center"
                    [ngClass]="{
                      'border-emerald-500 ring-2 ring-emerald-500/50 shadow-xl shadow-emerald-500/40 z-30':
                        selectedClipId() === clip.id,
                      'border-white/5 hover:border-white/20':
                        selectedClipId() !== clip.id,
                    }"
                    [style.left.px]="clip.startTime * pixelsPerSecond"
                    [style.width.px]="clip.duration * pixelsPerSecond"
                  >
                    <!-- Waveform Graphic -->
                    <div
                      class="flex items-center gap-0.5 h-full w-full justify-center px-2 opacity-80"
                    >
                      <div
                        *ngFor="
                          let i of getSequence(
                            (clip.duration * pixelsPerSecond) / 10
                          )
                        "
                        class="flex-1 rounded-[180px] bg-gradient-to-r from-[rgba(30,220,136,0.75)] to-[rgba(37,165,163,0.75)]"
                        [style.height.%]="getRandomHeight(i)"
                      ></div>
                    </div>

                    <!-- Trim Handles for Audio -->
                    <div
                      class="absolute left-0 top-0 bottom-0 w-1.5 bg-white/20 cursor-ew-resize"
                    ></div>
                    <div
                      class="absolute right-0 top-0 bottom-0 w-1.5 bg-white/20 cursor-ew-resize"
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Timer -->
          <!-- Timer -->
          <div class="absolute bottom-2 right-2 w-max z-20">
            <span class="text-sky-300 text-sm"
              >{{ formatTime(currentTime()) }}
            </span>
            <span class="text-white/90 mx-1">|</span>
            <span class="text-white/90 text-sm">{{
              formatTime(totalDuration())
            }}</span>
          </div>
        </div>
      </div>
    </div>


  </div>
</div>
